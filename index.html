<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maze Quest: Professional Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      margin:0; font-family:'Segoe UI',Roboto,sans-serif;
      background: linear-gradient(135deg,#1a2980 0%,#26d0ce 100%);
      color: #f5f6fa;
      min-height: 100vh; transition: background 1s;
    }
    #menu,#controls,#about,#ballSelect,#game,#scoreScreen {
      display: none; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh; width: 100vw; position: absolute; left:0;top:0;
      z-index: 10; background: rgba(25,42,86,0.98); opacity: 1;
      transition: opacity 0.5s;
    }
    .menu-btn {
      background: linear-gradient(90deg,#182C61 40%,#44bd32 100%);
      color: #fff; border: none; margin: 15px; padding: 18px 50px; font-size: 1.3em;
      border-radius: 14px; cursor:pointer; box-shadow: 0 4px 16px #222;
      transition: background .2s, box-shadow .3s, transform .2s;
      outline: none;
    }
    .menu-btn:active { background: #0097e6; box-shadow: 0 4px 32px #00a8ff; transform: scale(1.04);}
    .menu-btn i {margin-right:10px;}
    #ballOptions { display: flex; gap: 28px; margin-top: 35px; }
    .ball-option {
      width:65px; height:65px; border-radius:50%; border: 5px solid #fff; cursor:pointer;
      display:flex;align-items:center;justify-content:center; font-weight:bold; font-size:1.1em;
      box-shadow: 0 2px 18px #333; transition: transform .2s, box-shadow .2s, border-color .2s;
      position:relative;
    }
    .ball-option:active { transform: scale(1.13); box-shadow:0 4px 32px #44bd32;}
    .ball-red { background:#e74c3c; }
    .ball-blue { background:#0097e6; }
    .ball-green { background:#44bd32; }
    .ball-black { background:#353b48; border-color:#e1b12c; }
    .ball-option.selected {border-color:#fbc531;}
    #mazeCanvas {
      background: linear-gradient(135deg,#dff9fb 0%,#c7ecee 100%);
      border: 6px solid #353b48; display: block; margin: 20px auto;
      box-shadow: 0 4px 32px #0097e6a8; touch-action: none; border-radius: 18px; transition: box-shadow .4s;
    }
    #controlsUI { display: flex; justify-content: center; margin-top: 15px; gap: 15px; }
    .ctrl-btn {
      background: linear-gradient(90deg,#353b48 60%,#0097e6 100%);
      color: #fff; border: none; border-radius: 14px; font-size: 1.4em; padding: 24px 34px; cursor:pointer;
      box-shadow: 0 2px 12px #222; transition: background .2s, box-shadow .3s; min-width: 80px; min-height: 60px;
      outline: none;
      font-weight: 600;
      letter-spacing: 2px;
    }
    .ctrl-btn:active { background: #44bd32; box-shadow: 0 2px 24px #0097e6; }
    #timer {
      font-size: 1.6em; margin-top: 10px; color: #fbc531;
      text-shadow: 0 2px 8px #0097e688; letter-spacing: 2px; font-weight: bold; transition: color .5s;
      margin-bottom: 12px;
    }
    #scoreScreen h2 { color: #44bd32; text-shadow: 0 2px 12px #0097e655; margin-bottom:10px;}
    #scoreScreen p {font-size:1.2em;}
    #scoreScreen .menu-btn {margin-top:20px;}
    .fade-in {animation:fadein .8s;}
    @keyframes fadein {from {opacity:0;} to {opacity:1;} }
    @media (max-width:700px) {
      .menu-btn, .ctrl-btn { font-size:1em; padding:15px 20px; }
      #mazeCanvas { width:97vw; }
      .ball-option { width:43px; height:43px; font-size:1em; }
    }
  </style>
</head>
<body>
  <audio id="bgMusic" loop preload="auto" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12b890eae4.mp3"></audio>
  <div id="menu" style="display:flex;">
    <h1 style="text-shadow: 2px 3px 16px #00a8ff; font-size:2.7em;letter-spacing:2px;">Maze Quest</h1>
    <button class="menu-btn" onclick="showBallSelect()"><i class="fas fa-play"></i>Start Game</button>
    <button class="menu-btn" onclick="showControls()"><i class="fas fa-gamepad"></i>Controls</button>
    <button class="menu-btn" onclick="showAbout()"><i class="fas fa-user"></i>About Developer</button>
  </div>
  <div id="controls">
    <h2><i class="fas fa-keyboard"></i> Controls</h2>
    <p>
      Use the four buttons or keyboard:<br>
      <strong>‚Üë</strong> Up or <strong>W</strong> &nbsp; <strong>‚Üì</strong> Down or <strong>S</strong> &nbsp;
      <strong>‚Üê</strong> Left or <strong>A</strong> &nbsp; <strong>‚Üí</strong> Right or <strong>D</strong><br>
      Tap, click, or hold keys/buttons to move your ball. Reach the exit before time runs out!<br>
      <span style="color:#44bd32;">Quick Tip:</span>
      <span style="font-size:0.98em;">The exit glows when you're close!</span>
    </p>
    <button class="menu-btn" onclick="showMenu()"><i class="fas fa-arrow-left"></i>Back</button>
  </div>
  <div id="about">
    <h2><i class="fas fa-user"></i> About Developer</h2>
    <p style="max-width: 600px;">
      Saad is an 18-year-old aspiring game developer from Islamabad, passionate about creating immersive gaming experiences.
      With a keen interest in design and code, Saad is continually learning and refining his craft. "Maze Quest" is his latest project, aiming to blend fun and challenge with a professional touch. Saad dreams of building games people love and welcomes feedback to help him grow.
    </p>
    <button class="menu-btn" onclick="showMenu()"><i class="fas fa-arrow-left"></i>Back</button>
  </div>
  <div id="ballSelect">
    <h2><i class="fas fa-circle"></i> Select Your Ball</h2>
    <div id="ballOptions">
      <div class="ball-option ball-red" onclick="selectBall(this,'red')" title="Red"></div>
      <div class="ball-option ball-blue" onclick="selectBall(this,'blue')" title="Blue"></div>
      <div class="ball-option ball-green" onclick="selectBall(this,'green')" title="Green"></div>
      <div class="ball-option ball-black" onclick="selectBall(this,'black')" title="Black"></div>
    </div>
    <button class="menu-btn" onclick="showMenu()" style="margin-top:25px;"><i class="fas fa-arrow-left"></i>Back</button>
    <button id="startBtn" class="menu-btn" style="margin-top:15px;display:none;"><i class="fas fa-play"></i>Start Game</button>
  </div>
  <div id="game">
    <div id="timer">Time: <span id="timeLeft">60</span>s</div>
    <canvas id="mazeCanvas" width="620" height="620"></canvas>
    <div id="controlsUI">
      <button class="ctrl-btn" 
        onclick="clickMove('up')" 
        onmousedown="holdMove('up')" 
        ontouchstart="holdMove('up')"
        onmouseup="releaseMove()"
        ontouchend="releaseMove()">‚Üë</button>
      <button class="ctrl-btn" 
        onclick="clickMove('left')" 
        onmousedown="holdMove('left')" 
        ontouchstart="holdMove('left')"
        onmouseup="releaseMove()"
        ontouchend="releaseMove()">‚Üê</button>
      <button class="ctrl-btn" 
        onclick="clickMove('down')" 
        onmousedown="holdMove('down')" 
        ontouchstart="holdMove('down')"
        onmouseup="releaseMove()"
        ontouchend="releaseMove()">‚Üì</button>
      <button class="ctrl-btn" 
        onclick="clickMove('right')" 
        onmousedown="holdMove('right')" 
        ontouchstart="holdMove('right')"
        onmouseup="releaseMove()"
        ontouchend="releaseMove()">‚Üí</button>
    </div>
  </div>
  <div id="scoreScreen">
    <h2 id="scoreMsg"></h2>
    <p id="scoreDetails"></p>
    <button class="menu-btn" onclick="showMenu()"><i class="fas fa-arrow-left"></i>Back to Menu</button>
  </div>
<script>
  // Wooden and Mud textures
  let woodImg = new Image();
  woodImg.src = "https://cdn.pixabay.com/photo/2016/11/22/19/13/wood-1853404_960_720.jpg"; // royalty free wood
  let mudImg = new Image();
  mudImg.src = "https://cdn.pixabay.com/photo/2017/07/16/10/43/mud-2506900_960_720.jpg"; // royalty free mud

  let woodPattern = null, mudPattern = null, patternsReady = false;
  woodImg.onload = mudImg.onload = function() {
    let canvas = document.createElement('canvas').getContext('2d');
    let mainCanvas = document.getElementById('mazeCanvas');
    if (mainCanvas) {
      let ctx = mainCanvas.getContext('2d');
      woodPattern = ctx.createPattern(woodImg, 'repeat');
      mudPattern = ctx.createPattern(mudImg, 'repeat');
      patternsReady = true;
    }
  };

  // UI & music control
  function hideAll() {
    document.querySelectorAll("#menu,#controls,#about,#ballSelect,#game,#scoreScreen")
      .forEach(e=>e.style.display='none');
  }
  function showMenu() { 
    hideAll(); document.getElementById('menu').style.display='flex'; stopTimer(); stopMusic();
    document.body.style.background = 'linear-gradient(135deg,#1a2980 0%,#26d0ce 100%)';
  }
  function showControls() { hideAll(); document.getElementById('controls').style.display='flex'; }
  function showAbout() { hideAll(); document.getElementById('about').style.display='flex'; }
  function showBallSelect() { 
    hideAll(); document.getElementById('ballSelect').style.display='flex';
    Array.from(document.querySelectorAll('.ball-option')).forEach(el=>el.classList.remove('selected'));
    document.getElementById('startBtn').style.display='none';
  }
  function showGame() {
    hideAll(); document.getElementById('game').style.display='flex';
    document.body.style.background = 'linear-gradient(120deg, #222 0%, #0097e6 100%)';
    playMusic();
  }
  function showScoreScreen(win, score) {
    hideAll();
    document.getElementById('scoreScreen').style.display='flex';
    document.getElementById('scoreMsg').textContent = win ? "üèÜ Victory!" : "Game Over";
    document.getElementById('scoreDetails').innerHTML = win 
      ? `Congratulations! You reached the exit with <span style="color:#fbc531;">${score}s</span> left.<br>Try again for a better time!`
      : `You failed to escape the maze in time.<br>Practice and challenge yourself!`;
    stopMusic();
    document.body.style.background = win 
      ? 'linear-gradient(120deg, #44bd32 0%, #0097e6 100%)'
      : 'linear-gradient(120deg, #e74c3c 0%, #353b48 100%)';
  }
  function playMusic() {
    const music = document.getElementById('bgMusic');
    if (music.paused) { music.volume = 0.45; music.play().catch(()=>{}); }
  }
  function stopMusic() {
    const music = document.getElementById('bgMusic');
    if (!music.paused) music.pause();
    music.currentTime = 0;
  }
  // Ball Selection Logic
  let selectedColor = null;
  function selectBall(el,color){
    selectedColor = color;
    Array.from(document.querySelectorAll('.ball-option')).forEach(x=>x.classList.remove('selected'));
    el.classList.add('selected');
    document.getElementById('startBtn').style.display='inline-block';
  }
  document.getElementById('startBtn').onclick=function(){
    if(selectedColor) startGame(selectedColor);
  };

  // Maze generation (Recursive Backtracking)
  const MAZE_SIZE = 31;
  let maze = [];
  let startRow=1, startCol=1, exitRow=MAZE_SIZE-2, exitCol=MAZE_SIZE-2;
  function generateMaze() {
    maze = Array.from({length:MAZE_SIZE},()=>Array(MAZE_SIZE).fill(1));
    function shuffle(arr) {
      for(let i=arr.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function carve(r,c) {
      maze[r][c]=0;
      let dirs = shuffle([[0,-2],[0,2],[-2,0],[2,0]]);
      for(let [dr,dc] of dirs){
        let nr = r+dr, nc = c+dc;
        if(nr>0 && nr<MAZE_SIZE-1 && nc>0 && nc<MAZE_SIZE-1 && maze[nr][nc]==1){
          maze[r+dr/2][c+dc/2]=0;
          carve(nr,nc);
        }
      }
    }
    carve(startRow,startCol);
    maze[exitRow][exitCol]='E';
    for(let i=0;i<12;i++){
      let r=Math.floor(Math.random()*(MAZE_SIZE-3))+2, c=Math.floor(Math.random()*(MAZE_SIZE-3))+2;
      if(maze[r][c]===1 &&
        ((maze[r-1][c]===0 && maze[r+1][c]===0) || (maze[r][c-1]===0 && maze[r][c+1]===0))){
        maze[r][c]=0;
      }
    }
    for(let i=0;i<8;i++){
      let r=Math.floor(Math.random()*(MAZE_SIZE-3))+1, c=Math.floor(Math.random()*(MAZE_SIZE-3))+1;
      if(maze[r][c]==0){ maze[r][c+1]=0; maze[r+1][c]=0;}
    }
  }

  // Ball and Game State
  let ball = {row:startRow, col:startCol, x:0, y:0, color:'red', radius:10};
  let ballMoving=false, timer=60, timerID=null, gameActive=false, moveDirection=null, moveInterval=null;
  function startGame(color){
    ball.color=color; ball.row=startRow; ball.col=startCol;
    ball.x=ball.col*20+10; ball.y=ball.row*20+10;
    timer=60; moveDirection=null; showGame(); generateMaze(); drawMaze(); updateTimer();
    gameActive=true; startTimer();
  }

  // Drawing with textures and smooth animation
  let pulseBall=false, pulseStep=0, ballAnimProps={};
  function drawMaze(){
    const canvas = document.getElementById('mazeCanvas'), ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw shadow under maze grid
    ctx.save();
    ctx.shadowColor="#353b48";
    ctx.shadowBlur=22;
    ctx.fillStyle="rgba(220,220,255,0.04)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.restore();

    // Wait for textures to load
    let drawWalls = function(x,y){
      if(patternsReady && woodPattern){
        ctx.save();
        ctx.fillStyle = woodPattern;
        ctx.fillRect(x+2,y+2,16,16);
        ctx.strokeStyle = "#a67c52";
        ctx.lineWidth = 2;
        ctx.strokeRect(x+2,y+2,16,16);
        ctx.restore();
      }else{
        ctx.save();
        ctx.fillStyle="rgba(53,59,72,0.93)";
        ctx.strokeStyle="rgba(44,62,80,0.5)";
        ctx.lineWidth=2;
        ctx.fillRect(x+2,y+2,16,16);
        ctx.strokeRect(x+2,y+2,16,16);
        ctx.restore();
      }
    };

    let drawMud = function(x,y){
      if(patternsReady && mudPattern){
        ctx.save();
        ctx.fillStyle = mudPattern;
        ctx.fillRect(x,y,20,20);
        ctx.restore();
      }else{
        ctx.save();
        ctx.fillStyle="rgba(255,255,255,0.945)";
        ctx.fillRect(x,y,20,20);
        ctx.restore();
      }
    };

    for(let r=0;r<MAZE_SIZE;r++){
      for(let c=0;c<MAZE_SIZE;c++){
        let cell=maze[r][c], x=c*20, y=r*20;
        // Wall cell
        if(cell===1){
          drawWalls(x,y);
        }
        // Exit cell (animated glow)
        else if(cell==='E'){
          let dist = Math.abs(ball.row-exitRow)+Math.abs(ball.col-exitCol);
          let pulse = dist<=2?(Math.sin(Date.now()/160)+1)*0.28+0.75:1;
          ctx.save(); ctx.globalAlpha=pulse;
          ctx.shadowColor="#fbc531";
          ctx.shadowBlur=24*pulse;
          ctx.fillStyle="#fbc531";
          ctx.fillRect(x,y,20,20);
          ctx.fillStyle="#e74c3c";
          ctx.fillRect(x+2,y+14,16,4);
          ctx.restore();
        }
        // Path cell
        else{
          drawMud(x,y);
        }
      }
    }
    // Ball with modern effect and smoother movement
    ctx.save();
    let pulseR = ball.radius;
    let bounce = 0;
    if(pulseBall){ pulseR += Math.sin(pulseStep)*4; pulseStep+=0.2; if(pulseStep>Math.PI*2)pulseStep=0;}
    if(ballAnimProps.bounce){
      bounce = Math.abs(Math.sin(ballAnimProps.bouncePhase))*5;
    }
    ctx.beginPath();
    ctx.arc(ball.x,ball.y-bounce,pulseR,0,2*Math.PI);
    let grad = ctx.createRadialGradient(ball.x,ball.y-bounce,pulseR*0.6,ball.x,ball.y-bounce,pulseR);
    let colorMap = {
      red:["#e74c3c","#f6e58d"],blue:["#0097e6","#dff9fb"],green:["#44bd32","#badc58"],black:["#353b48","#636e72"]
    };
    let colors = colorMap[ball.color]||["#e74c3c","#f6e58d"];
    grad.addColorStop(0.0,colors[0]);
    grad.addColorStop(0.7,colors[1]);
    grad.addColorStop(1.0,"#fff");
    ctx.fillStyle=grad;
    ctx.shadowColor="#0097e6";
    ctx.shadowBlur=pulseBall?16:9; ctx.fill(); ctx.restore();
    if(pulseBall || bounce){
      ctx.save(); ctx.globalAlpha=0.18; ctx.beginPath();
      ctx.arc(ball.x,ball.y-bounce,pulseR+8,0,2*Math.PI); ctx.fillStyle="#44bd32";
      ctx.shadowBlur=24; ctx.fill(); ctx.restore();
    }
  }

  // Movement: Click for single step, Hold for continuous
  function canMove(dir){
    let dr=0,dc=0;
    if(dir=='up'||dir=='w')dr=-1;
    if(dir=='down'||dir=='s')dr=1;
    if(dir=='left'||dir=='a')dc=-1;
    if(dir=='right'||dir=='d')dc=1;
    let nr=ball.row+dr,nc=ball.col+dc;
    if(nr<0||nr>=MAZE_SIZE||nc<0||nc>=MAZE_SIZE)return false;
    return maze[nr][nc]!==1;
  }
  function moveOneStep(dir,callback){
    let dr=0,dc=0;
    if(dir=='up'||dir=='w')dr=-1;
    if(dir=='down'||dir=='s')dr=1;
    if(dir=='left'||dir=='a')dc=-1;
    if(dir=='right'||dir=='d')dc=1;
    let nr=ball.row+dr,nc=ball.col+dc;
    if(nr<0||nr>=MAZE_SIZE||nc<0||nc>=MAZE_SIZE){if(callback)callback(false);return;}
    if(maze[nr][nc]===1){if(callback)callback(false);return;}
    ballMoving=true; pulseBall=true;
    ballAnimProps = {bounce:true, bouncePhase:0};
    let targetX=nc*20+10,targetY=nr*20+10,duration=110,startTime=null,sx=ball.x,sy=ball.y;
    function animate(ts){
      if(!startTime)startTime=ts; let elapsed=ts-startTime;
      let t=Math.min(elapsed/duration,1);
      // Smoother slide with quadratic ease and slight bounce
      ball.x=sx+(targetX-sx)*easeInOutQuad(t);
      ball.y=sy+(targetY-sy)*easeInOutQuad(t);
      ballAnimProps.bouncePhase = t * Math.PI * 2.1;
      drawMaze();
      if(t<1)requestAnimationFrame(animate);
      else{
        ball.x=targetX; ball.y=targetY; ball.row=nr; ball.col=nc;
        ballMoving=false; pulseBall=false; ballAnimProps={}; drawMaze(); checkWinOrLose();
        if(callback)callback(true);
      }
    }
    requestAnimationFrame(animate);
  }
  function easeInOutQuad(t){
    return t<0.5?2*t*t:1-2*(1-t)*(1-t);
  }

  // Multiple clicks: single step per click
  function clickMove(dir){
    if(!gameActive)return;
    if(ballMoving)return;
    if(canMove(dir))moveOneStep(dir);
  }
  // Hold for continuous movement
  function holdMove(dir){
    if(!gameActive)return;
    if(moveInterval)return;
    moveDirection=dir;
    function tryMove(){
      if(!gameActive||!moveDirection)return;
      if(ballMoving)return;
      if(canMove(moveDirection))
        moveOneStep(moveDirection,function(success){
          if(success)setTimeout(tryMove,10);
        });
    }
    tryMove();
    moveInterval=setInterval(function(){
      if(!moveDirection||!gameActive){clearInterval(moveInterval);moveInterval=null;}
    },250);
  }
  function releaseMove(){
    moveDirection=null; clearInterval(moveInterval); moveInterval=null;
  }
  // Keyboard: Multiple press/clicks and hold for continuous
  let keyDown=false,keyDir=null;
  document.addEventListener('keydown',function(e){
    if(!gameActive)return;
    let dir=null;
    if(e.key==="ArrowUp"||e.key==="w"||e.key==="W")dir='up';
    if(e.key==="ArrowDown"||e.key==="s"||e.key==="S")dir='down';
    if(e.key==="ArrowLeft"||e.key==="a"||e.key==="A")dir='left';
    if(e.key==="ArrowRight"||e.key==="d"||e.key==="D")dir='right';
    if(!dir)return;
    if(ballMoving)return;
    if(!keyDown){ keyDown=true; keyDir=dir; holdMove(dir);}
    else clickMove(dir); // If not holding, do single click move
  });
  document.addEventListener('keyup',function(e){
    keyDown=false; keyDir=null; releaseMove();
  });

  // Touch gestures for swipe
  let touchStartX=0,touchStartY=0;
  document.getElementById('mazeCanvas').addEventListener('touchstart',function(e){
    if(e.touches.length==1){
      touchStartX=e.touches[0].clientX;
      touchStartY=e.touches[0].clientY;
    }
  });
  document.getElementById('mazeCanvas').addEventListener('touchend',function(e){
    if(e.changedTouches.length==1){
      let dx=e.changedTouches[0].clientX-touchStartX, dy=e.changedTouches[0].clientY-touchStartY;
      let dir=null;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx>30)dir='right';
        else if(dx<-30)dir='left';
      }else{
        if(dy>30)dir='down';
        else if(dy<-30)dir='up';
      }
      if(dir)clickMove(dir);
    }
  });

  function checkWinOrLose(){
    if(maze[ball.row][ball.col]==='E'){
      gameActive=false; stopTimer(); showScoreScreen(true,timer);
    }
  }
  function startTimer(){
    timerID=setInterval(function(){
      if(!gameActive)return;
      timer--; updateTimer();
      if(timer<=0){gameActive=false;stopTimer();showScoreScreen(false,0);}
    },1000);
  }
  function stopTimer(){if(timerID)clearInterval(timerID);timerID=null;}
  function updateTimer(){
    document.getElementById('timeLeft').textContent=timer;
    document.getElementById('timer').style.color=timer<15?'#e74c3c':'#fbc531';
  }
  showMenu();
  function pulseAnimLoop(){
    if(gameActive)drawMaze();
    requestAnimationFrame(pulseAnimLoop);
  }
  pulseAnimLoop();
</script>
</body>
</html>
